<% layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/css/stars.css">

<h1>Welcome to view <%= parkingLot.name %></h1>

<div id="carouselIndicator" class="carousel slide w-50 carousel-fade">
    <% if (parkingLot.images.length > 1) { %>
    <div class="carousel-indicators">
        <% for(let i = 0; i < parkingLot.images.length; i++) { %>
        <button type="button" data-bs-target="#carouselIndicator" data-bs-slide-to="<%= i %>"
            class="<%= (i == 0) ? "active" : "" %>" aria-current="true" aria-label="Slide <%= i+1 %>"></button>
        <% } %>
    </div>
    <% } %>

    <div class="carousel-inner">
        <% parkingLot.images.forEach((img, i) =>  { %>
        <div class="carousel-item <%= (i == 0) ? "active" : "" %>">
            <img src="<%= img.url %>" class="d-block w-100" alt="ParkingLot Image">
        </div>
        <% }) %>
    </div>

    <% if (parkingLot.images.length > 1) { %>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselIndicator" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>

    <button class="carousel-control-next" type="button" data-bs-target="#carouselIndicator" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
    <% } %>
</div>

<div id='map' style='width: 600px; height: 300px;'></div>

<h4>Listed by <%= (parkingLot.owner) ? parkingLot.owner.username : 'N/A' %></h4>

<select name="" id="">
    <% for(let pricePair of parkingLot.priceTable) { %>

    <option value="">
        <%= pricePair.start %> - <%= pricePair.end %> â‚º <%= pricePair.price %>
    </option>
    <% } %>
</select>

<p>Listed since <%= new Date(parkingLot.createdAt).toDateString() %> </p>

<% for(let floor of parkingLot.floors) { %>
<h4>Slots for floor #<%= floor.floorNum %>:</h4>
<table>
    <thead>
        <tr>
            <th>Availability</th>
            <th>Occupied By</th>
            <th>Floor Number</th>
            <th>Located At</th>
        </tr>
    </thead>

    <tbody>

        <% for(let slot of floor.slots) { %>
        <tr>
            <th><%= slot.isFull %></th>
            <th><%= slot.occupierCar %></th>
            <th><%= slot.floorNum %></th>
            <th><%= slot.locatedAt.location %></th>
        </tr>
        <% } %>
    </tbody>
</table>
<br>
<% } %>

<% if (currentUser && parkingLot.owner.equals(currentUser)) { %>
<a href="/parkingLots/<%= parkingLot._id %>/edit">
    <button class="btn btn-info">Edit Lot</button>
</a>

<form action="/parkingLots/<%= parkingLot._id %>?_method=DELETE" method="post">
    <button class="btn btn-danger">Delete Lot</button>
</form>
<% } %>

<h4 id="reviews">Reviews:</h4>
<% for(let review of parkingLot.reviews) { %>
<h6 class="d-inline">Submitted by <%= review.author.username %></h6>
<img class="rounded-circle" src="<%= review.author.image.avatar %>" alt="">
<h4>Title: <%= review.title %></h4>

<h4>Rating:</h4>
<p class="starability-result" data-rating="<%= review.rating %>">
    Rated: <%= review.rating %> stars
</p>

<p>Body: <%= review.body %></p>
<p>Votes: <%= review.votes %></p>

<% if (currentUser && review.author.equals(currentUser)) { %>
<a href="/parkingLots/<%= parkingLot._id %>/reviews/<%= review._id %>/edit">
    <button class="btn btn-info">Edit Review</button>
</a>

<form action="/parkingLots/<%= parkingLot._id %>/reviews/<%= review._id %>?_method=DELETE" method="post">
    <button class="btn btn-danger">Delete Review</button>
</form>
<% } %>
<% } %>

<form action="/parkingLots/<%= parkingLot._id %>/reviews" method="post" novalidate class="validated-form col-3">
    <h2>Make a review</h2>

    <fieldset class="starability-heart">
        <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked
            aria-label="No rating." />
        <input type="radio" id="first-rate1" name="review[rating]" value="1" />
        <label for="first-rate1" title="Terrible">1 star</label>
        <input type="radio" id="first-rate2" name="review[rating]" value="2" />
        <label for="first-rate2" title="Not good">2 stars</label>
        <input type="radio" id="first-rate3" name="review[rating]" value="3" />
        <label for="first-rate3" title="Average">3 stars</label>
        <input type="radio" id="first-rate4" name="review[rating]" value="4" />
        <label for="first-rate4" title="Very good">4 stars</label>
        <input type="radio" id="first-rate5" name="review[rating]" value="5" />
        <label for="first-rate5" title="Amazing">5 stars</label>
    </fieldset>

    <label for="title">Title:</label>
    <input class="form-control" type="text" name="review[title]" id="title" required>

    <label for="body">Review:</label>
    <textarea class="form-control mb-4" name="review[body]" id="body" required></textarea>

    <% if (currentUser) { %>
    <button class="btn btn-success">Submit</button>
    <% } else { %>
    <p class="text-danger">Please sign in to leave a review.</p>
    <% } %>
</form>



<style>
    th,
    td {
        border: 1px solid black;
        width: 100px;
    }

    th {
        text-align: center;
    }

    td {
        padding-left: 9px;
    }
</style>

<script>
    const mapToken = '<%- process.env.MAPBOX_TOKEN %>'
    const parkingLot = <%- JSON.stringify(parkingLot) %>
</script>


<script src="/js/showPageMapBox.js"></script>